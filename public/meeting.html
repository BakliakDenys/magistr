<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–î–µ—Ç–∞–ª—ñ –∑—É—Å—Ç—Ä—ñ—á—ñ</title>
  <link rel="stylesheet" href="styles.css">
       <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
   <style>
    body.hidden { display: none; }
    body *:not(button):not(.nav-button) {
      font-family: 'Patrick Hand', cursive;
    }
  </style>
</head>
<body>

<div class="top-bar">
  <img id="avatarImage" alt="–ê–≤–∞—Ç–∞—Ä" class="avatar2">
  <div class="user-email" id="userEmail">email@example.com</div>
  <button id="authButton" class="logout-btn nav-button"></button>
</div>
  
<!-- –ö–Ω–æ–ø–∫–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–µ–Ω—é -->
<button id="menuToggle" class="nav-button">‚ò∞ –ú–µ–Ω—é</button>

<!-- –ë–æ–∫–æ–≤–µ –º–µ–Ω—é -->
<div id="sideMenu" class="side-menu">
  <a href="/" class="nav-button">–ì–æ–ª–æ–≤–Ω–∞</a>
  <a href="/profile.html" class="nav-button">–ü—Ä–æ—Ñ—ñ–ª—å</a>
  <a href="/users.html" class="nav-button">–í—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</a>
  <a href="/about.html" class="nav-button">–í—ñ–¥–≥—É–∫–∏</a>

  <button id="createMeetingToggle" class="nav-button submenu-toggle">
    –ó—É—Å—Ç—Ä—ñ—á—ñ ‚ñº
  </button>
  <div id="createMeetingSubmenu" class="submenu">
    <a href="/create-meeting.html" class="nav-button">‚ûï –ù–æ–≤–∞ –∑—É—Å—Ç—Ä—ñ—á</a>
    <a href="/meetings.html" class="nav-button">üìã –í—Å—ñ –∑—É—Å—Ç—Ä—ñ—á—ñ</a>
  </div>
</div>

<a href="/" class="floating-logo">
  <img src="/logo.PNG" alt="–õ–æ–≥–æ—Ç–∏–ø">
</a>
  <div id="meetingDetails"></div>
  <button id="joinButton" class="nav-button">–Ø –±—É–¥—É!</button>
  <button id="deleteMeetingBtn" class="nav-button danger-btn">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏ –∑—É—Å—Ç—Ä—ñ—á</button>
  <script src="script.js"></script>
   <script src="create-meeting.js"></script>
      <script src="meetings.js"></script>
  <script>
    const token = localStorage.getItem('token');
    const params = new URLSearchParams(window.location.search);
    const meetingId = params.get('id');

async function fetchMeeting() {
  const res = await fetch(`/api/meetings/${meetingId}`);
  const meeting = await res.json();

  const details = document.getElementById('meetingDetails');
  details.innerHTML = `
    <img src="${meeting.imageUrl}" width="300">
    <h2>${meeting.title}</h2>
    <p><strong>–î–∞—Ç–∞:</strong> ${meeting.date}</p>
    <p><strong>–ß–∞—Å:</strong> ${meeting.startTime} ‚Äì ${meeting.endTime}</p>
    <p><strong>–ú—ñ—Å—Ü–µ:</strong> ${meeting.location}</p>
    <p><strong>–û–ø–∏—Å:</strong> ${meeting.description}</p>
    <p><strong>–£—á–∞—Å–Ω–∏–∫–∏ (${meeting.participants.length}/${meeting.maxParticipants}):</strong><br>
      ${meeting.participants.join(', ') || '–ù–µ–º–∞—î'}
    </p>
    <p><strong>–°—Ç–≤–æ—Ä–∏–≤:</strong> ${meeting.creatorEmail}</p> <!-- –î–æ–¥–∞–Ω–æ –ø–æ–ª–µ creatorEmail -->
  `;

  const joinBtn = document.getElementById('joinButton');
  if (meeting.participants.length >= meeting.maxParticipants) {
    joinBtn.textContent = '–ú—ñ—Å—Ü—å –Ω–µ–º–∞—î';
    joinBtn.classList.add('full');
    joinBtn.disabled = true;
  }

  joinBtn.onclick = async () => {
    if (!token) {
      alert("–£–≤—ñ–π–¥—ñ—Ç—å –¥–ª—è –∑–∞–ø–∏—Å—É");
      return;
    }

    const res = await fetch(`/api/meetings/${meetingId}/register`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${token}`,
      },
    });

    if (res.ok) {
      alert('–í–∏ —É—Å–ø—ñ—à–Ω–æ –∑–∞–ø–∏—Å–∞–ª–∏—Å—è!');
      window.location.reload();
    } else {
      const data = await res.json();
      alert(data.message || '–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–ø–∏—Å–∞—Ç–∏—Å—è');
    }
  };
}


    fetchMeeting();



  </script>
</body>
</html>
